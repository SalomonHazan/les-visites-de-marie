{% extends "base.html" %}

{% block title %}Nouveau Carnet de Culture - {{ config.site_title }}{% endblock %}

{% block content %}
<div class="admin-form-container">
    <div class="admin-form-header">
        <h2>‚ûï Nouveau Carnet de Culture</h2>
        <a href="{{ url_for('menu_page', menu_id='cultures') }}" class="btn btn-secondary">‚Üê Retour aux cultures</a>
    </div>

    <form method="POST" action="{{ url_for('admin_create_carnet_culture') }}" enctype="multipart/form-data" class="admin-form">
        <div class="form-section">
            <h3>Informations g√©n√©rales</h3>
            
            <div class="form-group">
                <label for="categorie">Cat√©gorie</label>
                <select id="categorie" name="categorie" required>
                    <option value="musees_expositions" {% if categorie == 'musees_expositions' %}selected{% endif %}>üèõÔ∏è Mus√©es & Expositions</option>
                    <option value="theatre_spectacles" {% if categorie == 'theatre_spectacles' %}selected{% endif %}>üé≠ Th√©√¢tre & Spectacles</option>
                    <option value="litterature" {% if categorie == 'litterature' %}selected{% endif %}>üìö Litt√©rature</option>
                </select>
                <small>Choisissez la cat√©gorie de votre carnet de culture</small>
            </div>

            <div class="form-group">
                <label for="titre">Titre du carnet</label>
                <input type="text" id="titre" name="titre" required>
                <small>Le titre principal de votre carnet de culture</small>
            </div>

            <div class="form-group">
                <label for="description_courte">Description courte</label>
                <textarea id="description_courte" name="description_courte" rows="2" required></textarea>
                <small>Une br√®ve description qui appara√Ætra sur la carte</small>
            </div>

            <div class="form-group">
                <label for="description_complete">Description compl√®te</label>
                <textarea id="description_complete" name="description_complete" rows="4" required></textarea>
                <small>La description d√©taill√©e de votre carnet de culture</small>
            </div>

            <div class="form-group">
                <label for="image_file">Image du carnet</label>
                <input type="file" id="image_file" name="image_file" accept="image/*" class="file-input" required>
                <small>Formats accept√©s : PNG, JPG, JPEG, GIF, WEBP (max 10MB)</small>
            </div>
        </div>

        <div class="form-section">
            <h3>√âtapes du carnet</h3>
            <div id="etapes-container">
                <!-- Les √©tapes seront ajout√©es ici dynamiquement -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="addEtape()">‚ûï Ajouter une √©tape</button>
        </div>

        <div class="form-section">
            <h3>Conseils</h3>
            <div id="conseils-container">
                <!-- Les conseils seront ajout√©s ici dynamiquement -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="addConseil()">‚ûï Ajouter un conseil</button>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Cr√©er le carnet</button>
            <a href="{{ url_for('menu_page', menu_id='cultures') }}" class="btn btn-secondary">Annuler</a>
        </div>
    </form>
</div>

<script>
let etapeIndex = 0;
let conseilIndex = 0;

function addEtape() {
    const container = document.getElementById('etapes-container');
    const etapeDiv = document.createElement('div');
    etapeDiv.className = 'etape-form';
    etapeDiv.innerHTML = `
        <div class="form-group">
            <label>Titre de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][titre]" required>
        </div>
        <div class="form-group">
            <label>Description de l'√©tape ${etapeIndex + 1}</label>
            <textarea name="etapes[${etapeIndex}][description]" rows="3" required></textarea>
        </div>
        <div class="form-group">
            <label>Dur√©e de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][duree]" placeholder="ex: 30 min" required>
        </div>
        <div class="form-group">
            <label>Adresse de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][adresse]" placeholder="Ex: Mus√©e du Louvre, 75001 Paris">
            <small>L'adresse sera utilis√©e pour g√©n√©rer une carte du parcours</small>
        </div>
        <div class="form-group">
            <label>M√©tro de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][metro]" placeholder="Ex: Palais Royal - Mus√©e du Louvre (lignes 1 et 7)">
            <small>Informations sur les transports en commun pour acc√©der √† cette √©tape</small>
        </div>
        <button type="button" class="btn btn-danger btn-small remove-etape" onclick="removeEtape(this)">Supprimer cette √©tape</button>
    `;
    container.appendChild(etapeDiv);
    etapeIndex++;
}

function removeEtape(button) {
    button.parentElement.remove();
}

function addConseil() {
    const container = document.getElementById('conseils-container');
    const conseilDiv = document.createElement('div');
    conseilDiv.className = 'conseil-form';
    conseilDiv.innerHTML = `
        <div class="form-group">
            <label>Conseil ${conseilIndex + 1}</label>
            <input type="text" name="conseils[${conseilIndex}]" required>
            <button type="button" class="btn btn-danger btn-small remove-conseil" onclick="removeConseil(this)">Supprimer</button>
        </div>
    `;
    container.appendChild(conseilDiv);
    conseilIndex++;
}

function removeConseil(button) {
    button.parentElement.remove();
}

// Ajouter automatiquement une premi√®re √©tape et un premier conseil
document.addEventListener('DOMContentLoaded', function() {
    addEtape();
    addConseil();
});
</script>
{% endblock %} 