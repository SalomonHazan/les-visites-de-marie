{% extends "base.html" %}

{% block title %}Modifier le carnet - {{ config.site_title }}{% endblock %}

{% block content %}
<div class="admin-form-container">
    <div class="admin-form-header">
        <h2>‚úèÔ∏è Modifier le carnet "{{ carnet.titre }}"</h2>
        <a href="{{ url_for('carnets_categorie', menu_id=menu_id, categorie=categorie) }}" class="btn btn-secondary">‚Üê Retour √† la cat√©gorie</a>
    </div>
    
    <form method="POST" action="{{ url_for('admin_update_carnet', menu_id=menu_id, categorie=categorie, carnet_id=carnet_id) }}" enctype="multipart/form-data" class="admin-form">
        <div class="form-section">
            <h3>Informations du carnet</h3>
            
            <div class="form-group">
                <label for="titre">Titre du carnet *</label>
                <input type="text" id="titre" name="titre" value="{{ carnet.titre }}" required>
                <small>Le titre principal du carnet</small>
            </div>
            
            <div class="form-group">
                <label for="description_courte">Description courte *</label>
                <textarea id="description_courte" name="description_courte" rows="3" required>{{ carnet.description_courte }}</textarea>
                <small>Une br√®ve description qui appara√Ætra sur la carte</small>
            </div>
            
            <div class="form-group">
                <label for="description_complete">Description compl√®te *</label>
                <textarea id="description_complete" name="description_complete" rows="6" required>{{ carnet.description_complete }}</textarea>
                <small>La description d√©taill√©e du carnet</small>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Image du carnet</h3>
            
            {% if carnet.image_url %}
                <div class="current-image">
                    <label>Image actuelle :</label>
                    <img src="{{ url_for('static', filename=carnet.image_url) if carnet.image_url.startswith('uploads/') else carnet.image_url }}" alt="Image actuelle" style="max-width: 200px; max-height: 200px;">
                </div>
            {% endif %}
            
            <div class="form-group">
                <label for="image_file">Nouvelle image (optionnel)</label>
                <input type="file" id="image_file" name="image_file" accept=".png,.jpg,.jpeg,.gif,.webp">
                <small>Formats accept√©s : PNG, JPG, JPEG, GIF, WEBP (max 10MB). Laissez vide pour conserver l'image actuelle.</small>
            </div>
        </div>
        
        <div class="form-section">
            <h3>√âtapes du carnet</h3>
            <div id="etapes-container">
                {% for etape in carnet.etapes %}
                    <div class="etape-item">
                        <div class="form-group">
                            <label>Titre de l'√©tape {{ loop.index }}</label>
                            <input type="text" name="etapes[{{ loop.index0 }}][titre]" value="{{ etape.titre }}" placeholder="Ex: Introduction">
                        </div>
                        <div class="form-group">
                            <label>Description de l'√©tape {{ loop.index }}</label>
                            <textarea name="etapes[{{ loop.index0 }}][description]" rows="3" placeholder="Description de cette √©tape">{{ etape.description }}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Dur√©e de l'√©tape {{ loop.index }}</label>
                            <input type="text" name="etapes[{{ loop.index0 }}][duree]" value="{{ etape.duree }}" placeholder="Ex: 30 minutes">
                        </div>
                        <div class="form-group">
                            <label>Adresse de l'√©tape {{ loop.index }}</label>
                            <input type="text" name="etapes[{{ loop.index0 }}][adresse]" value="{{ etape.adresse }}" placeholder="Ex: 123 Rue de la Paix, Paris">
                        </div>
                        <div class="form-group">
                            <label>M√©tro de l'√©tape {{ loop.index }}</label>
                            <input type="text" name="etapes[{{ loop.index0 }}][metro]" value="{{ etape.metro }}" placeholder="Ex: M√©tro R√©publique">
                        </div>
                        <button type="button" class="btn btn-small btn-delete remove-etape">üóëÔ∏è Supprimer cette √©tape</button>
                    </div>
                {% else %}
                    <div class="etape-item">
                        <div class="form-group">
                            <label>Titre de l'√©tape 1</label>
                            <input type="text" name="etapes[0][titre]" placeholder="Ex: Introduction">
                        </div>
                        <div class="form-group">
                            <label>Description de l'√©tape 1</label>
                            <textarea name="etapes[0][description]" rows="3" placeholder="Description de cette √©tape"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Dur√©e de l'√©tape 1</label>
                            <input type="text" name="etapes[0][duree]" placeholder="Ex: 30 minutes">
                        </div>
                        <div class="form-group">
                            <label>Adresse de l'√©tape 1</label>
                            <input type="text" name="etapes[0][adresse]" placeholder="Ex: 123 Rue de la Paix, Paris">
                        </div>
                        <div class="form-group">
                            <label>M√©tro de l'√©tape 1</label>
                            <input type="text" name="etapes[0][metro]" placeholder="Ex: M√©tro R√©publique">
                        </div>
                    </div>
                {% endfor %}
            </div>
            <button type="button" id="add-etape" class="btn btn-secondary">+ Ajouter une √©tape</button>
        </div>
        
        <div class="form-section">
            <h3>Conseils</h3>
            <div id="conseils-container">
                {% for conseil in carnet.conseils %}
                    <div class="conseil-item">
                        <div class="form-group">
                            <label>Conseil {{ loop.index }}</label>
                            <textarea name="conseils[{{ loop.index0 }}]" rows="2" placeholder="Un conseil utile pour ce carnet">{{ conseil }}</textarea>
                        </div>
                        <button type="button" class="btn btn-small btn-delete remove-conseil">üóëÔ∏è Supprimer ce conseil</button>
                    </div>
                {% else %}
                    <div class="conseil-item">
                        <div class="form-group">
                            <label>Conseil 1</label>
                            <textarea name="conseils[0]" rows="2" placeholder="Un conseil utile pour ce carnet"></textarea>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <button type="button" id="add-conseil" class="btn btn-secondary">+ Ajouter un conseil</button>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Modifier le carnet</button>
            <a href="{{ url_for('carnets_categorie', menu_id=menu_id, categorie=categorie) }}" class="btn btn-secondary">Annuler</a>
        </div>
    </form>
</div>

<script>
let etapeIndex = {{ carnet.etapes|length }};
let conseilIndex = {{ carnet.conseils|length }};

document.getElementById('add-etape').addEventListener('click', function() {
    const container = document.getElementById('etapes-container');
    const newEtape = document.createElement('div');
    newEtape.className = 'etape-item';
    newEtape.innerHTML = `
        <div class="form-group">
            <label>Titre de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][titre]" placeholder="Ex: Introduction">
        </div>
        <div class="form-group">
            <label>Description de l'√©tape ${etapeIndex + 1}</label>
            <textarea name="etapes[${etapeIndex}][description]" rows="3" placeholder="Description de cette √©tape"></textarea>
        </div>
        <div class="form-group">
            <label>Dur√©e de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][duree]" placeholder="Ex: 30 minutes">
        </div>
        <div class="form-group">
            <label>Adresse de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][adresse]" placeholder="Ex: 123 Rue de la Paix, Paris">
        </div>
        <div class="form-group">
            <label>M√©tro de l'√©tape ${etapeIndex + 1}</label>
            <input type="text" name="etapes[${etapeIndex}][metro]" placeholder="Ex: M√©tro R√©publique">
        </div>
        <button type="button" class="btn btn-small btn-delete remove-etape">üóëÔ∏è Supprimer cette √©tape</button>
    `;
    container.appendChild(newEtape);
    etapeIndex++;
    
    newEtape.querySelector('.remove-etape').addEventListener('click', function() {
        container.removeChild(newEtape);
    });
});

document.getElementById('add-conseil').addEventListener('click', function() {
    const container = document.getElementById('conseils-container');
    const newConseil = document.createElement('div');
    newConseil.className = 'conseil-item';
    newConseil.innerHTML = `
        <div class="form-group">
            <label>Conseil ${conseilIndex + 1}</label>
            <textarea name="conseils[${conseilIndex}]" rows="2" placeholder="Un conseil utile pour ce carnet"></textarea>
        </div>
        <button type="button" class="btn btn-small btn-delete remove-conseil">üóëÔ∏è Supprimer ce conseil</button>
    `;
    container.appendChild(newConseil);
    conseilIndex++;
    
    newConseil.querySelector('.remove-conseil').addEventListener('click', function() {
        container.removeChild(newConseil);
    });
});

// Ajouter les event listeners pour les boutons de suppression existants
document.querySelectorAll('.remove-etape').forEach(button => {
    button.addEventListener('click', function() {
        this.parentElement.remove();
    });
});

document.querySelectorAll('.remove-conseil').forEach(button => {
    button.addEventListener('click', function() {
        this.parentElement.remove();
    });
});
</script>
{% endblock %} 